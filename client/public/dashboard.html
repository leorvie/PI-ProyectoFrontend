<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Gestor de Tareas</title>
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/sidebar.css">
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="stylesheet" href="./css/modal.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>Task Manager</h2>
                <div class="user-info" id="userInfo">
                    Cargando...
                </div>
            </div>
            
            <div class="sidebar-nav">
                <a href="dashboard.html" class="nav-item active">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    Dashboard
                </a>
                <a href="create-task.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M12 4v16m8-8H4"></path>
                    </svg>
                    Nueva Tarea
                </a>
                <a href="profile.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zM4 20a8 8 0 0 1 16 0z"></path>
                    </svg>
                    Ver perfil
                </a>
            </div>
            
            <div class="sidebar-footer">
                <button id="logout-btn" class="logout-btn">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Cerrar Sesión
                </button>
            </div>
        </nav>

        <!-- Mobile menu button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>

        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main content -->
        <main class="main-content">
            <div class="dashboard">
                <header class="dashboard-header">
                    <h1 id="user-greeting">Mis Tareas</h1>
                </header>

                <div class="tasks-container">
                    <div class="tasks-header">
                        <div class="tasks-filter">
                            <button class="filter-btn active" data-filter="all">Todas</button>
                            <button class="filter-btn" data-filter="Por Hacer">Por Hacer</button>
                            <button class="filter-btn" data-filter="Haciendo">Haciendo</button>
                            <button class="filter-btn" data-filter="Hecho">Hecho</button>
                        </div>
                        
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="kanban">
                                <svg class="view-icon" viewBox="0 0 24 24">
                                    <path d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                </svg>
                                Kanban
                            </button>
                            <button class="view-btn" data-view="list">
                                <svg class="view-icon" viewBox="0 0 24 24">
                                    <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"></path>
                                </svg>
                                Lista
                            </button>
                        </div>
                    </div>
                    
                    <!-- Vista Kanban -->
                    <div id="kanban-view" class="kanban-board">
                        <div class="kanban-column" data-status="Por Hacer">
                            <div class="column-header">
                                <h3>Por Hacer</h3>
                                <span class="task-count">0</span>
                            </div>
                            <div class="column-tasks" data-status="Por Hacer"></div>
                        </div>
                        
                        <div class="kanban-column" data-status="Haciendo">
                            <div class="column-header">
                                <h3>Haciendo</h3>
                                <span class="task-count">0</span>
                            </div>
                            <div class="column-tasks" data-status="Haciendo"></div>
                        </div>
                        
                        <div class="kanban-column" data-status="Hecho">
                            <div class="column-header">
                                <h3>Hecho</h3>
                                <span class="task-count">0</span>
                            </div>
                            <div class="column-tasks" data-status="Hecho"></div>
                        </div>
                    </div>
                    
                    <!-- Vista Lista -->
                    <div id="list-view" class="tasks-list" style="display: none;">
                        <div class="empty-state">
                            <h3>No tienes tareas aún</h3>
                            <p>¡Crea tu primera tarea para comenzar!</p>
                            <a href="create-task.html" class="btn btn-primary">Nueva Tarea</a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: flex;">
        <div class="loading-spinner"></div>
        <p>Cargando tareas...</p>
    </div>

    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Editar Tarea</h2>
            <form id="edit-task-form">
                <div class="form-group">
                    <label for="edit-title">Título</label>
                    <input type="text" id="edit-title" name="title" required maxlength="50">
                    <div class="char-counter"></div>
                </div>
                <div class="form-group">
                    <label for="edit-details">Detalles</label>
                    <textarea id="edit-details" name="details" rows="4" maxlength="500"></textarea>
                    <div class="char-counter"></div>
                </div>
                <div class="form-group">
                    <label for="edit-status">Estado</label>
                    <select id="edit-status" name="status" required>
                        <option value="Por Hacer">Por Hacer</option>
                        <option value="Haciendo">Haciendo</option>
                        <option value="Hecho">Hecho</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-task-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Eliminar Tarea</h2>
            <p>¿Estás seguro de que deseas eliminar esta tarea? Esta acción no se puede deshacer.</p>
            <div class="modal-actions">
                <button class="btn btn-danger" id="confirm-delete">Eliminar</button>
                <button class="btn btn-secondary" id="cancel-delete">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./src/js/services/api.js"></script>
    <script src="./src/js/utils/utils.js"></script>
    <script>
        // Asegurarnos de que ApiService esté disponible
        if (!window.ApiService) {
            window.location.href = '/auth.html?error=service_unavailable';
        }
    </script>
    <script src="./src/js/utils/sidebar.js"></script>
    <script src="./src/js/task-management.js"></script>
    <script src="./src/js/dashboard.js"></script>
</body>
</html>